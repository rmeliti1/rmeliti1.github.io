/* --- Existing CSS --- */
/* (Keep your other styles: body, header, nav, .knot-visual, etc.) */

/* Knot Grid Layout */
#knot-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    /* Add transition for smoother reflow when children change */
    transition: all 0.4s ease-in-out; /* Optional: helps grid animate changes */
}

/* Individual Knot Cards - Update Transitions */
.knot-card {
    background-color: #fff;
    border: 1px solid #ddd; /* Ensure border is defined */
    border-radius: 5px;
    padding: 15px;         /* Ensure padding is defined */
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    overflow: hidden;      /* Important: Prevents content spill during collapse */
    margin-bottom: 0; /* Let grid gap handle vertical spacing if needed */

    /* === Animation Properties (Normal State) === */
    opacity: 1;
    transform: scale(1);
    visibility: visible;
    height: auto; /* Or an estimated height if needed, but auto is preferred */
    border-width: 1px; /* Explicit border width */

    /* === UPDATED Transition Definition === */
    /* Transition ALL properties that will change in the .hidden state */
    transition: opacity 0.4s ease-in-out,
                transform 0.4s ease-in-out,
                height 0.4s ease-in-out,      /* Animate height */
                padding-top 0.4s ease-in-out, /* Animate padding */
                padding-bottom 0.4s ease-in-out,
                margin-top 0.4s ease-in-out,  /* Animate margins */
                margin-bottom 0.4s ease-in-out,
                border-width 0.4s ease-in-out, /* Animate border width */
                visibility 0s linear 0s;     /* Show immediately */
}


/* Class to hide knots during filtering - UPDATE Properties and Transition */
.knot-card.hidden {
   /* Make invisible */
   opacity: 0;
   transform: scale(0.95); /* Optional: slight scale down */
   pointer-events: none;

   /* === Collapse the element's space === */
   height: 0;           /* Collapse height */
   padding-top: 0;      /* Collapse padding */
   padding-bottom: 0;
   margin-top: 0;       /* Collapse margin */
   margin-bottom: 0;
   border-width: 0;     /* Collapse border */
   overflow: hidden;      /* Ensure content is clipped */

   /* Remove from layout flow *after* transition */
   visibility: hidden;

   /* === UPDATED Transition for .hidden state === */
   /* Apply same duration to layout properties as opacity/transform */
   /* Keep visibility delayed to match animation duration */
   transition: opacity 0.4s ease-in-out,
               transform 0.4s ease-in-out,
               height 0.4s ease-in-out,
               padding-top 0.4s ease-in-out,
               padding-bottom 0.4s ease-in-out,
               margin-top 0.4s ease-in-out,
               margin-bottom 0.4s ease-in-out,
               border-width 0.4s ease-in-out,
               visibility 0s linear 0.4s; /* Delay visibility change */
}

/* ... (Rest of your CSS, e.g., .knot-visual, footer, etc.) ... */

/* Ensure iframe styling is still correct */
.knot-visual img,
.knot-visual video, 
.knot-visual iframe { 
    max-width: 100%;  
    height: auto;     
    display: block;   
    margin: 5px auto; 
    border: none; 
    aspect-ratio: 16 / 9; /* Or adjust per video if needed */
}

/* Specific override for the Wikimedia video if it's not 16:9 */
/* You might need a specific class or ID on that iframe's parent */
/* Example: Give the bowline .knot-visual a class="wikimedia-video" */
.knot-visual.wikimedia-video iframe {
     aspect-ratio: 512 / 288; 
}
